<html>
	<head>
		<title>
			CSCI571 HW4
		</title>
	<meta charset="UTF-8"> 
    <script type="text/javascript"> 

		function viewXML(what)
        {
            var URL = what.URL.value;
            function loadXML(url)
            {
                if(window.XMLHttpRequest)
					//code for IE7+, Firefox, Chrome, Opera, Safari
					xmlhttp=new XMLHttpRequest();
				else
                    //code for IE6, IE5
                    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");

                xmlhttp.open("GET",url,false);
                xmlhttp.send();
                var xmlDoc = xmlhttp.responseText;
                //console.log(xmlDoc);
                return xmlDoc;

            }



            var xmlDoc = loadXML(URL);
            if(window.ActiveXObject)//if IE, simply execute script (due to async prop)
                {
                    if(xmlDoc.parseError.errorCode!=0)
                        {
                            var myErr=xmlDoc.parseError;
                            generateError(xmlDoc);
                            hWin=window.open("","Error","height=300,width=340");
                            hWin.document.write(html_text);
                            hWin.document.close();
                        }
                    else{
                        generateHTML(xmlDoc);
                        hWin=window.open("","Assignment4","height=800,width=600");
                        hWin.document.write(html_text);
                        hWin.document.close();
                    }
                }
            else
                {
                    //else if FF, execute script once XML object has loaded
                    if(xmlDoc.onload=generateHTML(xmlDoc)==false){
                        console.log("false");

					}
                    else
                    {
                        hWin=window.open("","Assignment4","height=800,width=600");
                    	hWin.document.write(html_text);
                    	hWin.document.close();
                    }
                }
            
        }
        
        function generateHTML(xmlDoc)
        {
            obj = JSON.parse(xmlDoc);
            html_text="<html><head><title>Assignment 4</title></head><body>";
			header_data = obj.Mainline.Table.Header.Data;
			row_elements = obj.Mainline.Table.Row;
            html_text+="<table border='2'>";
            html_text+="<tbody>";
            html_text+="<tr>";
			for (x in header_data)
			{
                html_text+="<th>"+header_data[x]+"</th>";
			}
            html_text+="</tr>";
			xx=460;
			for (x in row_elements) {
                html_text += "<tr>";
                no_notes = false;
                if ("Notes" in row_elements[x] == false) {
                    no_notes = true;
                }
                for (y in header_data) {
                    if (header_data[y] == "Hubs") {
                        html_text += "<td><ul>";
                        for( k in row_elements[x][header_data[y]]){
                            for (i in row_elements[x][header_data[y]][k])
                            	html_text += "<li>" + row_elements[x][header_data[y]][k][i] + "</li>";
                        }
                        html_text += "</ul></td>";
                    }
                    else if(header_data[y] == "Notes")
					{
                        if(no_notes)
					    	html_text+="<td></td>";
					    else
					        html_text+="<td>"+row_elements[x][header_data[y]]+"</td>";
					}
                    else if(header_data[y] == "Plane")
					{
					    html_text+="<td><img src='"+row_elements[x][header_data[y]]+"' width='"+460+"' height='"+287.5+"'></td>";
                    }
                    else if(header_data[y] == "HomePage")
                    {
                        html_text+="<td><center><a href='"+row_elements[x][header_data[y]]+"'>"+row_elements[x][header_data[y]]+"</a></center>";
                    }
                else{
                        html_text+="<td>"+row_elements[x][header_data[y]]+"</td>";
                    }
                }
                html_text+="</tr>";
            }
            html_text+="</tbody>";
            html_text+="</table>";
            html_text+="</body></html>";
            return true;


        }
    </script>
	</head>
	<body>
		<center>
			<div style="margin-top: 200px;">
				<p><b>Enter URL for Airlines List JSON file</b></p>
				<form name="myform" method="POST" id="location">
					<input style="margin-bottom: 20px;" type="text" name="URL" maxlength="255"  size="100" value="http://127.0.0.1:50596/airlinelist.json" />
					<br />
					<input type="button" name="submit" value="Submit  Query" onClick="viewXML(this.form)" />
				</form>
			</div>
		</center>
	<NOSCRIPT/>
	</body>
</html>